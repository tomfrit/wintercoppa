function ProcessPageListInit(){if(config.ProcessPageList){$("#"+config.ProcessPageList.containerID).ProcessPageList(config.ProcessPageList)}}$(document).ready(function(){ProcessPageListInit()});(function(a){a.fn.ProcessPageList=function(b){var c={mode:"",limit:35,rootPageID:0,showRootPage:true,selectedPageID:0,adminPageID:2,trashPageID:7,langID:0,selectAllowUnselect:false,selectShowPageHeader:true,selectShowPath:true,selectStartLabel:"Change",selectCancelLabel:"Cancel",selectSelectLabel:"Select",selectUnselectLabel:"Unselect",moreLabel:"More",trashLabel:"Trash",moveInstructionLabel:"Click and drag to move",selectSelectHref:"#",selectUnselectHref:"#",ajaxURL:config.urls.admin+"page/list/",ajaxMoveURL:config.urls.admin+"page/sort/",openPagination:0,openPageIDs:[],speed:200,useHoverActions:false,hoverActionDelay:250,hoverActionFade:150,spinnerMarkup:"<i class='ui-priority-secondary fa fa-fw fa-spin fa-spinner'></i>",labelName:""};a.extend(c,b);return this.each(function(i){var r=a(this);var z;var q=a(c.spinnerMarkup).addClass("PageListLoading");var A=0;var d=0;var e=false;function u(){z=a("<div class='PageListRoot'></div>");if(r.is(":input")){c.selectedPageID=r.val();if(!c.selectedPageID.length){c.selectedPageID=0}c.mode="select";r.before(z);y()}else{c.mode="actions";r.append(z);j(c.rootPageID>0?c.rootPageID:1,z,0,true)}if(c.useHoverActions&&!a("body").hasClass("touch-device")){z.addClass("PageListUseHoverActions");k()}}function k(){var D=null;var E=null;var C=null;function B(G){var H=G.find(".PageListActions");if(!H.is(":visible")||G.hasClass("PageListItemOpen")){G.addClass("PageListItemHover");H.css("display","inline").css("opacity",0).animate({opacity:1},c.hoverActionFade)}}function F(G){var H=G.find(".PageListActions");G.removeClass("PageListItemHover");if(H.is(":visible")){H.animate({opacity:0},c.hoverActionFade,function(){H.hide()})}}a(document).on("mouseover",".PageListItem",function(I){if(z.is(".PageListSorting")||z.is(".PageListSortSaving")){return}if(!a(this).children("a:first").is(":hover")){return}C=a(this);if(C.hasClass("PageListItemHover")){return}var G=a(this);if(D){clearTimeout(D)}var H=c.hoverActionDelay;D=setTimeout(function(){if(C.attr("class")==G.attr("class")){if(!C.children("a:first").is(":hover")){return}var J=a(".PageListItemHover");B(C);J.each(function(){F(a(this))})}},H)}).on("mouseout",".PageListItem",function(I){if(z.is(".PageListSorting")||z.is(".PageListSortSaving")){return}var G=a(this);if(G.hasClass("PageListItemOpen")){return}if(!G.hasClass("PageListItemHover")){return}var H=c.hoverActionDelay*0.7;E=setTimeout(function(){if(G.is(":hover")){return}if(G.attr("class")==C.attr("class")){return}F(G)},H)})}function y(){var B=a("<ul></ul>").addClass("PageListActions PageListSelectActions actions");var D=a("<p></p>").addClass("PageListSelectName");if(c.selectShowPageHeader){D.append(q)}var E=a("<a></a>").addClass("PageListSelectActionToggle").attr("href","#").text(c.selectStartLabel).click(function(){if(a(this).text()==c.selectStartLabel){j(c.rootPageID>0?c.rootPageID:1,z,0,true);a(this).text(c.selectCancelLabel)}else{z.children(".PageList").slideUp(c.speed,function(){a(this).remove()});a(this).text(c.selectStartLabel)}return false});B.append(a("<li></li>").append(E));z.append(a("<div></div>").addClass("PageListSelectHeader").append(D).append(B));if(c.selectShowPageHeader){var C=c.ajaxURL+"?id="+c.selectedPageID+"&render=JSON&start=0&limit=0&lang="+c.langID+"&mode="+c.mode;if(c.labelName.length){C+="&labelName="+c.labelName}a.getJSON(C,function(H){var F="";if(c.selectShowPath){F=H.page.path;if(F.substring(-1)=="/"){F=F.substring(0,F.length-1)}F=F.substring(0,F.lastIndexOf("/")+1);F='<span class="detail">'+F+"</span> "}var G=c.selectedPageID>0?F+H.page.label:"";z.children(".PageListSelectHeader").find(".PageListSelectName").html(G)})}}function t(){e=false}function v(B,C,I,M){var K=9;var D=Math.ceil(M/I);d=C>=I?Math.floor(C/I):0;if(d==0){A=0}else{if((d-K+1)>A){A=d-Math.floor(K/2)}else{if(A>0&&d==A){A=d-Math.ceil(K/2)}}}if(A>D-K){A=D-K}if(A<0){A=0}var J=a("<ul></ul>").addClass("PageListPagination").data("paginationInfo",{start:C,limit:I,total:M});var L=function(V){var P=a(this).parents("ul.PageListPagination");var U=P.data("paginationInfo");if(!U){return false}var Q=v(B,parseInt(a(this).attr("href"))*U.limit,U.limit,U.total);var S=a(c.spinnerMarkup);var T=a("<li>&nbsp;</li>").append(S.hide());P.siblings(".PageList").remove();P.replaceWith(Q);Q.append(T);S.fadeIn("fast");var R=Q.siblings().css("opacity",0.5);j(B,Q.parent(),a(this).attr("href")*U.limit,false,false,true,function(){S.fadeOut("fast",function(){T.remove()})});return false};var H=null;var E=null;for(var O=A,F=0;O<D;O++,F++){var G=a("<a></a>").html(O+1).attr("href",O).addClass("ui-state-default");var N=a("<li></li>").addClass("PageListPagination"+F).append(G);if(O==d){N.addClass("PageListPaginationCurrent").find("a").removeClass("ui-state-default").addClass("ui-state-active")}J.append(N);if(!E){E=N.clone().removeClass("PageListPaginationCurrent ui-state-active");E.find("a").removeClass("ui-state-active").addClass("ui-state-default")}if(!H){H=E.clone().removeClass("ui-state-default").html("&hellip;")}if(F>=K&&O<D){$lastItem=E.clone();$lastItem.find("a").text(D).attr("href",D-1);J.append(H.clone()).append($lastItem);break}}if(A>0){$firstItem=E.clone();$firstItem.find("a").text("1").attr("href","0").click(L);J.prepend(H.clone()).prepend($firstItem)}if(d+1<D){$nextBtn=E.clone();$nextBtn.find("a").html("<i class='fa fa-angle-right'></i>").attr("href",d+1);J.append($nextBtn)}if(d>0){$prevBtn=E.clone();$prevBtn.find("a").attr("href",d-1).html("<i class='fa fa-angle-left'></i>");J.prepend($prevBtn)}J.find("a").click(L).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")});return J}function j(C,F,D,H,J,E,I){if(J==undefined){J=true}if(E==undefined){E=false}var G=function(O){if(O&&O.error){alert(O.message);q.hide();e=false;return}var K=h(a(O.children));var N=O.start+O.limit;if(O.page.numChildren>N){var M=a("<a></a>").attr("href",N).data("pageId",C).text(c.moreLabel).click(x);K.append(a("<ul></ul>").addClass("PageListActions actions").append(a("<li></li>").addClass("PageListActionMore").append(M)));if(J){K.prepend(v(C,O.start,O.limit,O.page.numChildren))}}K.hide();if(H){var P;P=h(a(O.page));if(c.showRootPage){P.children(".PageListItem").addClass("PageListItemOpen")}else{P.children(".PageListItem").hide().parent(".PageList").addClass("PageListRootHidden")}P.append(K);F.append(P)}else{if(F.is(".PageList")){var L=K.children(".PageListItem, .PageListActions");if(E){F.children(".PageListItem, .PageListActions").replaceWith(L)}else{F.append(L)}}else{F.after(K)}}if(q.parent().is(".PageListRoot")){q.hide()}else{q.fadeOut("fast")}if(E){K.show();t();if(I!=undefined){I()}}else{K.slideDown(c.speed,function(){t();if(I!=undefined){I()}})}if(c.openPagination>1){var M=a(".PageListPagination a[href="+(c.openPagination-1)+"]");if(M.size()>0){M.click();c.openPagination=0}else{a(".PageListPagination9 a").click()}}};if(!E){F.append(q.fadeIn("fast"))}var B=c.ajaxURL+"?id="+C+"&render=JSON&start="+D+"&lang="+c.langID+"&open="+c.openPageIDs[0]+"&mode="+c.mode;if(c.labelName.length){B+="&labelName="+c.labelName}a.getJSON(B).done(function(L,M,K){G(L)}).fail(function(K,M,L){G({error:1,message:!K.status?c.ajaxNetworkError:c.ajaxUnknownError})})}function h(B){var D=a("<div></div>").addClass("PageList");var C=D;B.each(function(F,E){C.append(g(E))});o(C);return D}function o(B){a("a.PageListPage",B).click(p);a(".PageListActionMove a",B).click(f);a(".PageListActionSelect a",B).click(w);a(".PageListTriggerOpen a.PageListPage",B).click();a(".PageListActionExtras > a",B).on("click",l)}function g(H){var G=a("<div></div>").data("pageId",H.id).addClass("PageListItem").addClass("PageListTemplate_"+H.template);var F=a("<a></a>").attr("href","#").attr("title",H.path).html(H.label).addClass("PageListPage label");G.addClass("PageListID"+H.id);if(H.status==0){G.addClass("PageListStatusOff disabled")}if(H.status&2048){G.addClass("PageListStatusUnpublished secondary")}if(H.status&1024){G.addClass("PageListStatusHidden secondary")}if(H.status&512){G.addClass("PageListStatusTemp secondary")}if(H.status&16){G.addClass("PageListStatusSystem")}if(H.status&8){G.addClass("PageListStatusSystem")}if(H.status&4){G.addClass("PageListStatusLocked")}if(H.addClass&&H.addClass.length){G.addClass(H.addClass)}if(H.type&&H.type.length>0){if(H.type=="System"){G.addClass("PageListStatusSystem")}}a(c.openPageIDs).each(function(J,I){if(H.id==I){G.addClass("PageListTriggerOpen")}});G.append(F);var D=a("<span>"+(H.numChildren?H.numChildren:"")+"</span>").addClass("PageListNumChildren detail");G.append(D);if(H.note&&H.note.length){G.append(a("<span>"+H.note+"</span>").addClass("PageListNote detail"))}var E=a("<ul></ul>").addClass("PageListActions actions");var C=c.rootPageID==H.id?[]:[{name:c.selectSelectLabel,url:c.selectSelectHref}];if(c.mode=="actions"){C=H.actions}else{if(c.selectAllowUnselect){if(H.id==r.val()){C=[{name:c.selectUnselectLabel,url:c.selectUnselectHref}]}}}var B=null;a(C).each(function(M,K){var I;if(K.name==c.selectSelectLabel){I="Select"}else{if(K.name==c.selectUnselectLabel){I="Select"}else{I=K.cn}}var J=a("<a></a>").html(K.name).attr("href",K.url);if(typeof K.extras!="undefined"){J.data("extras",K.extras)}var L=a("<li></li>").addClass("PageListAction"+I).append(J);if(I=="Extras"){B=L}else{E.append(L)}});if(B){E.append(B);B.addClass("ui-priority-secondary")}G.append(E);return G}function l(I){var C=a(this);var E=C.data("extras");if(typeof E=="undefined"){return false}var L=C.closest(".PageListItem");var M=C.closest(".PageListActions");var G=null;var J=C.children("i.fa");var K=M.find("li.PageListActionExtra");J.toggleClass("fa-flip-horizontal");if(K.length){K.fadeOut(100,function(){K.remove()});return false}for(var D in E){var B=E[D];var H=a("<a />").addClass("PageListActionExtra PageListAction"+B.cn).attr("href",B.url).html(B.name);if(typeof B.ajax!="undefined"&&B.ajax==true){H.click(function(){L.find(".PageListActions").hide();var T=a(c.spinnerMarkup);var Q=a(this).attr("href");var P=Q.match(/[\?&]action=([-_a-zA-Z0-9]+)/)[1];var O=parseInt(Q.match(/[\?&]id=([0-9]+)/)[1]);var S=a("#PageListContainer").attr("data-token-name");var R=a("#PageListContainer").attr("data-token-value");var N={action:P,id:O};N[S]=R;L.append(T);a.post(Q+"&render=json",N,function(U){if(U.success){L.fadeOut("fast",function(){var aa=false;var ab=U.remove;var Z=U.refreshChildren;var X=false;if(typeof U.child!="undefined"){X=g(U.child)}else{if(typeof U.newChild!="undefined"){X=g(U.newChild);aa=true}}if(X){var V=a("<span />").addClass("notes").html(U.message);V.prepend("&nbsp;<i class='fa fa-check-square ui-priority-secondary'></i>&nbsp;");X.append(V);o(X)}if(aa){T.fadeOut("normal",function(){T.remove()});X.hide();L.after(X);X.slideDown()}else{if(X){if(L.hasClass("PageListItemOpen")){X.addClass("PageListItemOpen")}L.replaceWith(X)}}L.fadeIn("fast",function(){setTimeout(function(){V.fadeOut("normal",function(){if(ab){var ac=X.closest(".PageList").prev(".PageListItem").children(".PageListNumChildren");if(ac.length){var ad=parseInt(ac.text());if(ad>0){ac.text(ad-1)}}X.next(".PageList").fadeOut("fast");X.fadeOut("fast",function(){X.remove()})}else{V.remove()}})},1000)});if(Z){var W=a(".PageListID"+Z);if(W.length){W.addClass("PageListForceReload");var Y=W.children("a.PageListPage");if(W.hasClass("PageListItemOpen")){Y.click();setTimeout(function(){Y.click()},250)}else{Y.click()}}}})}else{T.remove();alert(U.message)}});return false})}else{}var F=a("<li />").addClass("PageListActionExtra PageListAction"+B.cn).append(H);H.hide();if(B.cn=="Trash"){L.addClass("trashable");G=F}else{M.append(F)}}if(G){M.append(G)}M.find(".PageListActionExtra a").fadeIn(50,function(){a(this).css("display","inline-block")});return false}function p(C){var F=a(this);var E=F.parent(".PageListItem");var D=E.data("pageId");if(e&&!E.is(".PageListTriggerOpen")){return false}if(z.is(".PageListSorting")||z.is(".PageListSortSaving")){return false}if(E.is(".PageListItemOpen")){E.removeClass("PageListItemOpen").next(".PageList").slideUp(c.speed,function(){a(this).remove()})}else{E.addClass("PageListItemOpen");var B=parseInt(E.children(".PageListNumChildren").text());if(B>0||E.hasClass("PageListForceReload")){e=true;j(D,E,0,false)}}return false}function x(E){var G=a(this);var C=G.parent("li").parent("ul.PageListActions");var B=C.parent(".PageList");var F=G.data("pageId");var D=parseInt(G.attr("href"));j(F,B,D,false);C.remove();return false}function f(){if(e){return false}var H=a(this);if(a(".PageListItem:visible").length==1){H.css("text-decoration","line-through").addClass("ui-state-disabled");return false}var G=H.parent("li").parent("ul.PageListActions").parent(".PageListItem");if(G.hasClass("PageListItemOpen")){G.children(".PageListPage").click()}z.find(".PageListItemOpen").each(function(){var J=a(this).children(".PageListNumChildren").text();if(parseInt(J)>1&&a(this).next().find(".PageList:visible").size()==0){return}var I=a("<div></div>").addClass("PageListPlaceholder").addClass("PageList");I.append(a("<div></div>").addClass("PageListItem PageListPlaceholderItem").html("&nbsp;"));a(this).after(I)});var F={stop:m,helper:"PageListItemHelper",items:".PageListItem:not(.PageListItemOpen)",placeholder:"PageListSortPlaceholder",start:function(J,I){a(".PageListSortPlaceholder").css("width",I.item.children(".PageListPage").outerWidth()+"px")}};var C=z.children(".PageList").children(".PageList");var B=a("<a href='#'>"+c.selectCancelLabel+"</a>").click(function(){return n(G)});var E=G.children("ul.PageListActions");var D=a("<span class='PageListMoveNote detail'><i class='fa fa-fw fa-sort'></i> "+c.moveInstructionLabel+"<i class='fa fa-fw fa-angle-left'></i></span>");D.append(B);E.before(D);G.addClass("PageListSortItem");G.parent(".PageList").attr("id","PageListMoveFrom");z.addClass("PageListSorting");C.addClass("PageListSortingList").sortable(F);return false}function n(C){var B=z.find(".PageListSortingList");B.sortable("destroy").removeClass("PageListSortingList");C.removeClass("PageListSortItem").parent(".PageList").removeAttr("id");C.find(".PageListMoveNote").remove();z.find(".PageListPlaceholder").remove();z.removeClass("PageListSorting");return false}function s(E){var B=z.find(".PageListID"+c.trashPageID);if(!B.hasClass("PageListItemOpen")){z.removeClass("PageListSorting");B.children("a").click();z.addClass("PageListSorting")}var C=B.next(".PageList");if(C.length==0){C=a("<div class='PageList'></div>");B.after(C)}C.prepend(E);var D={item:E};m(null,D)}function m(H,M){var J=M.item;var E=J.children(".PageListPage");var C=parseInt(J.data("pageId"));var G=J.parent(".PageList");var K=a("#PageListMoveFrom");var L=G.prev().is(".PageListItem")?G.prev():G.prev().prev();var I=parseInt(L.data("pageId"));var D=J.prev(".PageListItem");if(D.is(".PageListItemOpen")){return false}if(G.is(".PageListPlaceholder")){G.removeClass("PageListPlaceholder").children(".PageListPlaceholderItem").remove()}z.addClass("PageListSortSaving");n(J);J.append(q.fadeIn("fast"));var F="";G.children(".PageListItem").each(function(){F+=a(this).data("pageId")+","});var B={id:C,parent_id:I,sort:F};B[a("#PageListContainer").attr("data-token-name")]=a("#PageListContainer").attr("data-token-value");var N="unknown";a.post(c.ajaxMoveURL,B,function(Q){q.fadeOut("fast");E.fadeOut("fast",function(){a(this).fadeIn("fast");J.removeClass("PageListSortItem");z.removeClass("PageListSorting")});if(Q&&Q.error){alert(Q.message)}if(!G.is("#PageListMoveFrom")){var P=K.prev(".PageListItem");var O=P.children(".PageListNumChildren");var S=O.text().length>0?parseInt(O.text())-1:0;if(S==0){S="";K.remove()}O.text(S);var R=G.prev(".PageListItem");O=R.children(".PageListNumChildren");S=O.text().length>0?parseInt(O.text())+1:1;O.text(S)}K.attr("id","");z.removeClass("PageListSortSaving")},"json");J.trigger("pageMoved");return true}function w(){var H=a(this);var G=H.parent("li").parent("ul.PageListActions").parent(".PageListItem");var F=G.data("pageId");var D=G.children(".PageListPage");var E=D.text();var C=D.attr("title");var B=z.children(".PageListSelectHeader");if(H.text()==c.selectUnselectLabel){F=0;E=""}if(F!=r.val()){r.val(F).change()}if(c.selectShowPageHeader){B.children(".PageListSelectName").text(E)}r.trigger("pageSelected",{id:F,url:C,title:E,a:D});B.find(".PageListSelectActionToggle").click();if(c.selectSelectHref=="#"){return false}return true}u()})}})(jQuery);